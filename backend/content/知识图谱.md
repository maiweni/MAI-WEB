# 知识图谱



## 一、neo4j配置

- 使用docker安装neo4j，命令如下：

  ```
  1、查看系统中是否安装docker
  docker version
  
  2、拉取最新neo4j镜像，可能需要开启代理拉取
  docker pull neo4j:latest
  
  3、在用户目录下创建数据保存文件夹，防止容器删除后数据丢失
  mkdir -p ~/neo4j_data
  
  4、创建neo4j容器，neo4j/test123为用户名与密码
  docker run -d \
    --name neo4j \
    -p 7474:7474 -p 7687:7687 \
    -e NEO4J_AUTH=neo4j/test123 \
    -v ~/neo4j_data:/data \
    neo4j:5.13
  
  ```

  通过上述步骤完成neo4j的安装

- 测试neo4j是否可用

  浏览器打开http://localhost:7474，输入用户名与对应的密码，测试是否能够打开neo4j。

  ```
  在上方光标闪烁处输入：
  RETURN "Neo4j is ready!" AS status;
  
  返回结果：
  Neo4j is ready!
  
  
  ```






## 二、neo4j使用

- 使用python测试neo4j连接

  ```python
  from neo4j import GraphDatabase
  
  # 修改为你的密码
  URI = "bolt://localhost:7687"
  AUTH = ("neo4j", "ma114789")
  
  driver = GraphDatabase.driver(URI, auth=AUTH)
  
  def test_connection():
      with driver.session() as session:
          result = session.run("RETURN 'Connected to Neo4j via Python!' AS msg")
          print(result.single()["msg"])
  
  if __name__ == "__main__":
      test_connection()
  
  ```

- 测试写入知识图谱数据

  ```
  from neo4j import GraphDatabase
  
  URI = "bolt://localhost:7687"
  AUTH = ("neo4j", "ma114789")
  
  driver = GraphDatabase.driver(URI, auth=AUTH)
  
  triples = [
      ("马云", "创办", "阿里巴巴"),
      ("阿里巴巴", "总部位于", "杭州"),
      ("阿里巴巴", "子公司", "蚂蚁集团"),
      ("蚂蚁集团", "CEO", "井贤栋")
  ]
  
  def create_knowledge_graph(triples):
      with driver.session() as session:
          for h, r, t in triples:
              session.run(
                  """
                  MERGE (a:Entity {name: $h})
                  MERGE (b:Entity {name: $t})
                  MERGE (a)-[rel:RELATION {type: $r}]->(b)
                  """,
                  h=h, r=r, t=t
              )
      print("✅ 已成功将三元组写入 Neo4j！")
  
  if __name__ == "__main__":
      create_knowledge_graph(triples)
  
  
  
  ```

- neo4j查询

  ```
  from neo4j import GraphDatabase
  
  URI = "bolt://localhost:7687"
  AUTH = ("neo4j", "ma114789")
  
  driver = GraphDatabase.driver(URI, auth=AUTH)
  
  
  
  
  def query_relations(entity_name):
      with driver.session() as session:
          result = session.run(
              """
              MATCH (a:Entity {name: $name})-[r:RELATION]->(b)
              RETURN a.name AS source, r.type AS relation, b.name AS target
              """,
              name=entity_name
          )
          for record in result:
              print(f"{record['source']} -[{record['relation']}]-> {record['target']}")
  
  query_relations("阿里巴巴")
  
  ```

  

- 常用的cypher语句

  | 功能             | Cypher 示例                                                  | 解释             |
  | ---------------- | ------------------------------------------------------------ | ---------------- |
  | 创建节点         | `CREATE (a:Entity {name: '马云'})`                           | 新建一个实体节点 |
  | 创建关系         | `MATCH (a:Entity {name:'马云'}), (b:Entity {name:'阿里巴巴'}) CREATE (a)-[:创办]->(b)` | 连接两个节点     |
  | 合并（防止重复） | `MERGE (a:Entity {name:'马云'})`                             | 若不存在则创建   |
  | 创建三元组       | `MERGE (a:Entity {name:$h}) MERGE (b:Entity {name:$t}) MERGE (a)-[:RELATION {type:$r}]->(b)` | Python中常用写法 |
  | 查询节点         | `MATCH (a:Entity) RETURN a LIMIT 5`                          | 查看节点         |
  | 查询关系         | `MATCH (a)-[r]->(b) RETURN a,r,b LIMIT 5`                    | 查看图           |
  | 条件查询         | `MATCH (a:Entity {name:'阿里巴巴'})-[r]->(b) RETURN r,b`     | 查某个节点的关系 |
  | 删除节点         | `MATCH (a:Entity {name:'杭州'}) DETACH DELETE a`             | 删除节点及关系   |
  | 统计数量         | `MATCH (n:Entity) RETURN count(n)`                           | 统计节点数量     |
  | 模糊匹配         | `MATCH (n) WHERE n.name CONTAINS '马' RETURN n`              | 模糊查询         |



上述部分完成了基本的知识图谱的了解

---









